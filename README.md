# Tilnærminger til å holde typescript-typer i sync med eksterne webservices 

## Skygge typer
Tidkrevende, og er særlig sårbart for endringer. Avhengig av uformelle kanaler for å plukke dem opp. Også sårbart 
fordi man må gjøre en manuell jobb (skrivefeil, feiltolkning av andre språks typer)

## typescript-generator
Genererte typer. Kan gjøres som en del av bygget til backenden, og dermed vil endringer automatisk bli plukket opp av frontend, 
og potensielt brekke den (som er det vi vil). Kan fort glemmes av backend-teamet, som kan være både bra og dårlig. 
Backend er fortsatt sannheten, frontend kommer i andre rekke.

## Openapi-generator-cli

Openapi-spec'et er sannheten. På denne måten stiller både frontend og backend likt. Trenger bare ett bibliotek for å generere kode for både frontend og backend.
En utfordring er å bestemme hvem som skal generere frontend-koden, backend-teamet eller frontend-teamet? Ikke sikkert det er vilje/kompetanse i 
backend-teamet til å forvalte frontend-genereringen.

## Alternativer

### tRPC
(typescript Remote Procedure Call). Avhenger av at man har typescript både i backend og frontend. 
Lager RPC-aktige kall som ligner på måten openapi-generator gjør det:  

```typescript
const appRouter = router({
    user: {
        list: publicProcedure.query(async () => {
            // Retrieve users from a datasource, this is an imaginary database
            const users = await db.user.findMany();
            return users;
        }),
        byId: publicProcedure.input(z.string()).query(async (opts) => {
            const { input } = opts;
            // Retrieve the user with the given ID
            const user = await db.user.findById(input);
            return user;
        }),
        create: publicProcedure
            .input(z.object({ name: z.string() }))
            .mutation(async (opts) => {
                const { input } = opts;
                // Create a new user in the database
                const user = await db.user.create(input);
                return user;
            }),
    },
    examples: {
        iterable: publicProcedure.query(async function* () {
            for (let i = 0; i < 3; i++) {
                await new Promise((resolve) => setTimeout(resolve, 500));
                yield i;
            }
        }),
    },
});

// Brukes slik:
const users = await trpc.user.list.query();
console.log('Users:', users);

const createdUser = await trpc.user.create.mutate({ name: 'sachinraja' });
console.log('Created user:', createdUser);

const user = await trpc.user.byId.query('1');
console.log('User 1:', user);
```

### Openapi-typescript

Genererer typer basert på openapi-spec:
```typescript
import type { paths, components } from "./my-openapi-3-schema"; // generated by openapi-typescript

// Schema Obj
type MyType = components["schemas"]["MyType"];

// Path params
type EndpointParams = paths["/my/endpoint"]["parameters"];

// Response obj
type SuccessResponse =
paths["/my/endpoint"]["get"]["responses"][200]["content"]["application/json"]["schema"];
type ErrorResponse =
paths["/my/endpoint"]["get"]["responses"][500]["content"]["application/json"]["schema"];
```

